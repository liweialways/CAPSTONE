sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
h1_train %>%
select(dow, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, dow) %>%
summarise(avg_cxl_rate = mean(cxl_rate))
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
# product types
h1_train %>%
select(product_type, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(product_type) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
perc_cxl = avg_cancels/avg_bookings) %>%
arrange(perc_cxl) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
# product types
h1_train %>%
select(product_type, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(product_type) %>%
summarize(avg_cxl_rate = mean(cxl_rate))
arrange(avg_cxl_rate) %>%
# product types
h1_train %>%
select(product_type, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(product_type) %>%
summarize(avg_cxl_rate = mean(cxl_rate))
arrange(avg_cxl_rate)
# product types
h1_train %>%
select(product_type, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(product_type) %>%
summarize(avg_cxl_rate = mean(cxl_rate)) %>%
arrange(avg_cxl_rate)
# product types
h1_train %>%
select(product_type, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(product_type) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
perc_cxl = avg_cancels/avg_bookings) %>%
arrange(perc_cxl) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
# Clear environment of variables and functions
rm(list = ls(all = TRUE))
# Clear environmet of packages
if(is.null(sessionInfo()$otherPkgs) == FALSE)lapply(paste("package:", names(sessionInfo()$otherPkgs), sep=""), detach, character.only = TRUE, unload = TRUE)
library(tidyverse)
library(dplyr) # joins
#library(janitor) # pretty cross-tabs
library(kableExtra) # pretty html tables
library(formattable)
library(gridExtra)
library(scales)
library(pastecs)
library(GGally)
library(lubridate)
# Load 2 hotel data
hot1 <- read.csv('../raw_data/BOOKINGS_ATLCP.csv')
hot2 <- read.csv('../raw_data/BOOKINGS_NYCHA.csv')
# EDA only on training data
## Change date to date type
hot1$stay_dt <- as.Date(hot1$stay_dt, "%m/%d/%Y")
hot1$booking_dt <- as.Date(hot1$booking_dt, "%m/%d/%Y")
hot2$stay_dt <- as.Date(hot2$stay_dt, "%m/%d/%Y")
hot2$booking_dt <- as.Date(hot2$booking_dt, "%m/%d/%Y")
#create field for non-numerical dow
hot1$day_of_week <- as.factor(hot1$dow)
hot2$day_of_week <- as.factor(hot2$dow)
## Reserve last 3 weeks data as Validation Data and the prior are Training Data
h1_train <- hot1[hot1$stay_dt <= (max(hot1$stay_dt) - 21),]
h2_train <- hot2[hot2$stay_dt <= (max(hot2$stay_dt) - 21),]
head(h1_train)
# number of bookings and cancels in each days_prior
h1_train %>%
select(days_prior, daily_gross_bookings, daily_cxl_bookings) %>%
group_by(days_prior) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(avg_cancels)
# number of cancellations in each days_prior/each product type
h1_train %>%
select(days_prior, daily_cxl_bookings) %>%
group_by(days_prior) %>%
summarize(num = sum(daily_cxl_bookings))
h1_train %>%
select(product_type, daily_cxl_bookings) %>%
group_by(product_type) %>%
summarize(num = sum(daily_cxl_bookings))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(lable = product_type, x=days_prior, y=avg_cxl_rate, color = product_type))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(label = product_type, x=days_prior, y=avg_cxl_rate, color = product_type))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_text(aes(label = product_type))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_text(aes(data=h1_train, label = product_type))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
install.packages("directlabels")
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(labe = product_type), method = list(dl.combine("first.points", "last.points"), cex=0.8))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(labe = product_type, x=days_prior, y=avg_cxl_rate), method = list(dl.combine("first.points", "last.points"), cex=0.8))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate), method = list(dl.combine("first.points", "last.points"), cex=0.8))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate), method = list(dl.combine("first.points", "last.points"), cex=0.2))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
library(ggrepel)
install.packages("ggrepel")
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
library(ggrepel)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_label_repel(aes(label = label,x=days_prior, y=avg_cxl_rate, color = product_type),
nudge_x = 1,
na.rm = TRUE)
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
library(ggrepel)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_label_repel(aes(label = product_type,x=days_prior, y=avg_cxl_rate, color = product_type),
nudge_x = 1,
na.rm = TRUE)
#  geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
library(ggrepel)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_label_repel(aes(label = product_type,x=days_prior, y=avg_cxl_rate, group = product_type, color = product_type),
nudge_x = 1,
na.rm = TRUE)
#  geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
library(ggrepel)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# cxl rate curve = cummulative_cxl_bookings/cummulative_gross_bookings)
library(directlabels)
library(ggrepel)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate, color = product_type), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
## Daily cxls
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
## Cummulative cxl rate
h1_train %>%
select(day_of_week, cummulative_gross_bookings, cummulative_cxl_bookings)
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
## Daily cxls
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
## Cummulative cxl rate
h1_train %>%
select(day_of_week, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0)
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
## Daily cxls
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
## Cummulative cxl rate
h1_train %>%
select(day_of_week, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummlative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_cxl_rate = mean(cxl_rate))
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
## Daily cxls
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week) %>%
kable(align = c("c", "c", "c", "c")) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "bordered")) %>%
column_spec(1:3, color = "#000000")
## Cummulative cxl rate
h1_train %>%
select(day_of_week, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_cxl_rate = mean(cxl_rate))
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
## Daily cxls
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week)
## Cummulative cxl rate, need to exclude the records whos cummulative gross bookings=0 to avoid NaN values.
h1_train %>%
select(day_of_week, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_cxl_rate = mean(cxl_rate))
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
## Daily cxls
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week)
## Cummulative cxl rate, need to exclude the records whos cummulative gross bookings=0 to avoid NaN values.
h1_train %>%
select(day_of_week, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_cxl_rate = mean(cxl_rate))
h1_train %>%
select(day_of_week, days_prior, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(day_of_week, days_prior) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = day_of_week))+
geom_dl(aes(label = day_of_week, x=days_prior, y=avg_cxl_rate, color = day_of_week), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# 1-1. Understand the patterns of cancellation rate curves. Try to see if cancellation rates are different by DOW (day of week), product types (by different levels),  month, OTB (demand volume), daily/cumulative gross bookings, daily/cumulative cancellations, price, and etc. Graphical display (plots) will be helpful to understand the patterns.
# DOW
## Daily cxls
h1_train %>%
select(day_of_week, daily_cxl_bookings, daily_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_bookings = mean(daily_gross_bookings),
avg_cancels = mean(daily_cxl_bookings),
sum_bookings = sum(daily_gross_bookings),
sum_cancels = sum(daily_cxl_bookings)) %>%
arrange(day_of_week)
## Cummulative cxl rate, need to exclude the records whos cummulative gross bookings=0 to avoid NaN values.
h1_train %>%
select(day_of_week, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(day_of_week) %>%
summarise(avg_cxl_rate = mean(cxl_rate))
h1_train %>%
select(day_of_week, days_prior, cummulative_gross_bookings, cummulative_cxl_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(day_of_week, days_prior) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = day_of_week))+
geom_dl(aes(label = day_of_week, x=days_prior, y=avg_cxl_rate, color = day_of_week), method = list(dl.combine("first.points", "last.points"), cex=0.9))
# product types
# cxl rate curve = avg(cummulative_cxl_bookings/cummulative_gross_bookings))
library(directlabels)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate, color = product_type), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# month
h1_train$month = month(h1_train$stay_dt)
h1_train %>%
select(month, daily_gross_bookings) %>%
group_by(month) %>%
summarise(avg_bookings = mean(daily_gross_bookings)) %>%
ggplot(aes(x = reorder(month, -avg_bookings), y = avg_bookings)) +
geom_bar(stat = "identity", position = "dodge") +
theme_minimal() +
theme(axis.title = element_blank(),
axis.line.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_text(size = 11, face = "bold"),
axis.text.x = element_text(size = 11, face = "bold")) +
ggtitle("Average # of Bookings by Month")
# product types
# cxl rate curve = avg(cummulative_cxl_bookings/cummulative_gross_bookings))
library(directlabels)
h1_train %>%
select(product_type, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
filter(cummulative_gross_bookings != 0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, product_type) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = product_type))+
geom_dl(aes(label = product_type, x=days_prior, y=avg_cxl_rate, color = product_type), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# month
h1_train$month = month(h1_train$stay_dt)
h1_train %>%
select(month, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, month) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = month))+
geom_dl(aes(label = month, x=days_prior, y=avg_cxl_rate, color = product_type), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# month
h1_train$month = month(h1_train$stay_dt)
h1_train %>%
select(month, days_prior, cummulative_cxl_bookings, cummulative_gross_bookings) %>%
filter(cummulative_gross_bookings!=0) %>%
mutate(cxl_rate = cummulative_cxl_bookings/cummulative_gross_bookings) %>%
group_by(days_prior, month) %>%
summarise(avg_cxl_rate = mean(cxl_rate)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_cxl_rate, color = month))+
geom_dl(aes(label = month, x=days_prior, y=avg_cxl_rate, color = month), method = list(dl.combine("first.points", "last.points"), cex=0.5))
# OTB (demand volume)
h1_train %>%
select(days_prior, OTB) %>%
group_by(days_prior) %>%
summarise(avg_otb = mean(OTB))
# OTB (demand volume)
h1_train %>%
select(days_prior, OTB) %>%
group_by(days_prior) %>%
summarise(avg_otb = mean(OTB))
h1_train %>%
select(days_prior, product_type, OTB) %>%
group_by(days_prior, product_type) %>%
summarise(avg_otb = mean(OTB)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=OTB, color=product_type))
# OTB (demand volume)
h1_train %>%
select(days_prior, OTB) %>%
group_by(days_prior) %>%
summarise(avg_otb = mean(OTB))
h1_train %>%
select(days_prior, product_type, OTB) %>%
group_by(days_prior, product_type) %>%
summarise(avg_otb = mean(OTB)) %>%
ggplot()+
geom_line(aes(x=days_prior, y=avg_otb, color=product_type))
