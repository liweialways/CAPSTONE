# MAE
n_dp_grp1_wd_mae <- n_dp_grp1_wd_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_of_week, prod_group_perc) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
n_dp_grp1_wd_mae
# MAPE:
n_dp_grp1_wd_mape <- n_dp_grp1_wd_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_of_week, prod_group_perc) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
n_dp_grp1_wd_mape
# MASE
n_dp_grp1_wd_mase <- n_dp_grp1_wd_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt_2*OTB)) %>%
group_by(dp_range, day_of_week, prod_group_perc) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
n_dp_grp1_wd_mase
# forecast otb to survive
n_dp_grp2_wd_fcs <- left_join(hot2_test_2, n_dp_grp2_wd_mod, by=c("days_prior", "day_of_week", "prod_group_behav")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
n_dp_grp2_wd_fcs
# MAE
n_dp_grp2_wd_mae <- n_dp_grp2_wd_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_of_week, prod_group_behav) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
n_dp_grp2_wd_mae
# MAPE: the OTB_to_survive doesn't have 0 values.
n_dp_grp2_wd_mape <- n_dp_grp2_wd_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_of_week, prod_group_behav) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
n_dp_grp2_wd_mape
# MASE
n_dp_grp2_wd_mase <- n_dp_grp2_wd_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt_2*OTB)) %>%
group_by(dp_range, day_of_week, prod_group_behav) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
n_dp_grp2_wd_mase
# forecast otb to survive
n_dp_grp1_dtp_fcs <- left_join(hot2_test_1, n_dp_grp1_dtp_mod, by=c("days_prior", "day_type", "prod_group_perc")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
n_dp_grp1_dtp_fcs
# MAE
n_dp_grp1_dtp_mae <- n_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_of_week, prod_group_perc) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
n_dp_grp1_dtp_mae
# MAPE: the OTB_to_survive in GOVERNMENT contains 0 values, so MAPE is INF
n_dp_grp1_dtp_mape <- n_dp_grp1_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
n_dp_grp1_dtp_mape
# MASE
n_dp_grp1_dtp_mase <- n_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt*OTB)) %>%
group_by(dp_range, day_of_week, prod_group_perc) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
n_dp_grp1_dtp_mase
# forecast otb to survive
n_dp_grp2_dtp_fcs <- left_join(hot2_test_2, n_dp_grp2_dtp_mod, by=c("days_prior", "day_type", "prod_group_behav")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
n_dp_grp2_dtp_fcs
# MAE
n_dp_grp2_dtp_mae <- n_dp_grp2_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
n_dp_grp2_dtp_mae
# MAPE:
n_dp_grp2_dtp_mape <- n_dp_grp2_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
n_dp_grp2_dtp_mape
# MASE
n_dp_grp2_dtp_mase <- n_dp_grp2_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt_2*OTB)) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
n_dp_grp2_dtp_mase
left_join(a_dp_mae,a_dp_mape, by="dp_range")
left_join(left_join(a_dp_mae,a_dp_mape, by="dp_range"), a_dp_mase, by="dp_range")
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_wd_mae,a_dp_grp1_wd_mape, by="dp_range"), a_dp_grp1_wd_mase, by="dp_range")
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_wd_mae,a_dp_grp1_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp1_wd_mase, by="dp_range")
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_wd_mae,a_dp_grp1_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_grou_perc.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_wd_mae,a_dp_grp1_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_grou_perc, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_wd_mae,a_dp_grp1_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_grouP_perc, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_wd_mae,a_dp_grp1_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_perc, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_wd_mae,a_dp_grp1_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_perc.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp2_wd_mae,a_dp_grp2_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp2_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_perc.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp2_wd_mae,a_dp_grp2_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), a_dp_grp2_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_behav.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp2_wd_mae,a_dp_grp2_wd_mape, by=c("dp_range", "day_of_week","prod_group_behav")), a_dp_grp2_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_behav.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp3_wd_mae,a_dp_grp3_wd_mape, by=c("dp_range", "day_of_week","prod_group_cxl_rate")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_cxl_rate.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp3_wd_mae,a_dp_grp3_wd_mape, by=c("dp_range", "day_of_week","prod_group_cxl_rate")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_cxl_rate.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp3_wd_mae,a_dp_grp3_wd_mape, by=c("dp_range", "day_of_week","prod_group_cxl_rate")), a_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_cxl_rate, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_dtp_mae,a_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_behav")), a_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type, prod_group_behav, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp2_dtp_mae,a_dp_grp2_dtp_mape, by=c("dp_range", "day_type","prod_group_behav")), a_dp_grp2_dtp_mase, by="dp_range") %>%
select(dp_range, day_type, prod_group_behav, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp2_dtp_mae,a_dp_grp2_dtp_mape, by=c("dp_range", "day_type","prod_group_behav")), a_dp_grp2_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_behav, meanAE, meanAPE, meanASE)
# MAE
a_dp_grp1_dtp_mae <- a_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
a_dp_grp1_dtp_mae
# MAPE:
a_dp_grp1_dtp_mape <- a_dp_grp1_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
a_dp_grp1_dtp_mape
# MASE
a_dp_grp1_dtp_mase <- a_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt*OTB)) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
a_dp_grp1_dtp_mase
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_dtp_mae,a_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_behav")), a_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type, prod_group_behav, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_dtp_mae,a_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_perc")), a_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type, prod_group_perc, meanAE, meanAPE, meanASE)
# forecast otb to survive
a_dp_grp1_dtp_fcs <- left_join(hot1_test_1, a_dp_grp1_dtp_mod, by=c("days_prior", "day_type", "prod_group_perc")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
a_dp_grp1_dtp_fcs
# MAE
a_dp_grp1_dtp_mae <- a_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
a_dp_grp1_dtp_mae
# MAPE:
a_dp_grp1_dtp_mape <- a_dp_grp1_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
a_dp_grp1_dtp_mape
# MASE
a_dp_grp1_dtp_mase <- a_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt*OTB)) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
a_dp_grp1_dtp_mase
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_dtp_mae,a_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_perc")), a_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type, prod_group_perc, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_dtp_mae,a_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_perc")), a_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_perc, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp1_dtp_mae,a_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_perc")), a_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_perc.x, meanAE, meanAPE, meanASE)
# forecast otb to survive
a_dp_grp2_dtp_fcs <- left_join(hot1_test_2, a_dp_grp2_dtp_mod, by=c("days_prior", "day_type", "prod_group_behav")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
a_dp_grp2_dtp_fcs
# MAE
a_dp_grp2_dtp_mae <- a_dp_grp2_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
a_dp_grp2_dtp_mae
# MAPE
a_dp_grp2_dtp_mape <- a_dp_grp2_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
a_dp_grp2_dtp_mape
# MASE
a_dp_grp2_dtp_mase <- a_dp_grp2_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt*OTB)) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
a_dp_grp2_dtp_mase
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp2_dtp_mae,a_dp_grp2_dtp_mape, by=c("dp_range", "day_type","prod_group_behav")), a_dp_grp2_dtp_mase, by="dp_range") %>%
select(dp_range, day_type, prod_group_behav, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp2_dtp_mae,a_dp_grp2_dtp_mape, by=c("dp_range", "day_type","prod_group_behav")), a_dp_grp2_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_behav.x, meanAE, meanAPE, meanASE)
# forecast otb to survive
a_dp_grp3_dtp_fcs <- left_join(hot1_test_3, a_dp_grp3_dtp_mod, by=c("days_prior", "day_type", "prod_group_cxl_rate")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
a_dp_grp3_dtp_fcs
# MAE
a_dp_grp3_dtp_mae <- a_dp_grp3_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_cxl_rate) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
a_dp_grp3_dtp_mae
# MAPE
a_dp_grp3_dtp_mape <- a_dp_grp3_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_cxl_rate) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
a_dp_grp3_dtp_mape
# MASE
a_dp_grp3_dtp_mase <- a_dp_grp3_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt*OTB)) %>%
group_by(dp_range, day_type, prod_group_cxl_rate) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
a_dp_grp3_dtp_mase
# MAE, MAPE, MASE
left_join(left_join(a_dp_grp3_dtp_mae,a_dp_grp3_dtp_mape, by=c("dp_range", "day_type","prod_group_cxl_rate")), a_dp_grp3_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_cxl_rate.x, meanAE, meanAPE, meanASE)
# forecast otb to survive
n_dp_fcs <- left_join(hot2, n_dp_mod, by="days_prior") %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
# MAE
n_dp_mae <- n_dp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
n_dp_mae
# MAPE: the OTB_to_survive doesn't have 0 values.
n_dp_mape <- n_dp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
n_dp_mape
# MASE:
## Avg survival rate:
avg_svv_rt_2 <- sum(h2_train$OTB_to_survive)/sum(h2_train$OTB)
## MASE
n_dp_mase <- n_dp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt*OTB)) %>%
group_by(dp_range) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
n_dp_mase
# MAE, MAPE, MASE
left_join(left_join(n_dp_mae,n_dp_mape, by="dp_range"), n_dp_mase, by="dp_range")
# MAE, MAPE, MASE
left_join(left_join(n_dp_grp1_wd_mae,n_dp_grp1_wd_mape, by=c("dp_range", "day_of_week","prod_group_perc")), n_dp_grp1_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_perc.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(n_dp_grp2_wd_mae,n_dp_grp2_wd_mape, by=c("dp_range", "day_of_week","prod_group_behav")), n_dp_grp2_wd_mase, by="dp_range") %>%
select(dp_range, day_of_week.x, prod_group_behav.x, meanAE, meanAPE, meanASE)
# MAE, MAPE, MASE
left_join(left_join(n_dp_grp1_dtp_mae,n_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_perc")), n_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_perc.x, meanAE, meanAPE, meanASE)
# forecast otb to survive
n_dp_grp1_dtp_fcs <- left_join(hot2_test_1, n_dp_grp1_dtp_mod, by=c("days_prior", "day_type", "prod_group_perc")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
n_dp_grp1_dtp_fcs
# MAE
n_dp_grp1_dtp_mae <- n_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
n_dp_grp1_dtp_mae
# MAPE: the OTB_to_survive in GOVERNMENT contains 0 values, so MAPE is INF
n_dp_grp1_dtp_mape <- n_dp_grp1_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
n_dp_grp1_dtp_mape
# MASE
n_dp_grp1_dtp_mase <- n_dp_grp1_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt*OTB)) %>%
group_by(dp_range, day_type, prod_group_perc) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
n_dp_grp1_dtp_mase
# MAE, MAPE, MASE
left_join(left_join(n_dp_grp1_dtp_mae,n_dp_grp1_dtp_mape, by=c("dp_range", "day_type","prod_group_perc")), n_dp_grp1_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_perc.x, meanAE, meanAPE, meanASE)
# forecast otb to survive
n_dp_grp2_dtp_fcs <- left_join(hot2_test_2, n_dp_grp2_dtp_mod, by=c("days_prior", "day_type", "prod_group_behav")) %>%
mutate(fcst_svv = OTB-OTB*predict_cxl_rate)
n_dp_grp2_dtp_fcs
# MAE
n_dp_grp2_dtp_mae <- n_dp_grp2_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanAE = mae(OTB_to_survive, fcst_svv))
n_dp_grp2_dtp_mae
# MAPE:
n_dp_grp2_dtp_mape <- n_dp_grp2_dtp_fcs %>%
filter(days_prior!=0, OTB_to_survive!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32')) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanAPE = mape(OTB_to_survive, fcst_svv))
n_dp_grp2_dtp_mape
# MASE
n_dp_grp2_dtp_mase <- n_dp_grp2_dtp_fcs %>%
filter(days_prior!=0) %>%
mutate(dp_range = case_when(days_prior >=1 & days_prior<=7 ~ '1_7',
days_prior >=8 & days_prior<=14 ~ '8_14',
days_prior >=15 & days_prior<=21 ~ '15_21',
days_prior >=22 & days_prior<=28 ~ '22_28',
days_prior >=29 ~ '29_32'),
abs_diff_1=abs(OTB_to_survive-fcst_svv),
abs_diff_2=abs(OTB_to_survive-avg_svv_rt_2*OTB)) %>%
group_by(dp_range, day_type, prod_group_behav) %>%
summarise(meanASE = sum(abs_diff_1)/sum(abs_diff_2))
n_dp_grp2_dtp_mase
# MAE, MAPE, MASE
left_join(left_join(n_dp_grp2_dtp_mae,n_dp_grp2_dtp_mape, by=c("dp_range", "day_type","prod_group_behav")), n_dp_grp2_dtp_mase, by="dp_range") %>%
select(dp_range, day_type.x, prod_group_behav.x, meanAE, meanAPE, meanASE)
